{% extends "layout.html" %}

{% block content %}
  <div class="page-header">
    <h1>MIT Pokerbots Scrimmage Server</h1>
  </div>
  {% if flash %}
    <div class="alert alert-{{ flash_level }}">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      {{ flash }}
    </div>
  {% endif %}
  {% if g.team.is_disabled %}
    <div class="alert alert-danger">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      Your team is currently disabled, and cannot challenge or receive new challenges.
    </div>
  {% endif %}
  <div class="row">
    <div class="span6">
      <h2>Team Standings</h2>
      <table class="table table-hover table-condensed table-bordered">
        <thead>
          <tr>
            <th>Name</th>
            <th>ELO</th>
            <th>W/L</th>
          </tr>
        </thead>
        <tbody>
          {% for team in teams|sort(attribute='elo', reverse=True) %}
            <tr{% if g.team == team %} class='info'{% elif team.must_autoaccept %} class='warning'{% endif %}>
              <td>{{ team.name }}</td>
              <td>{{ team.elo|round }}</td>
              <td>{{ team.wins }}/{{ team.losses }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if g.settings['challenges_enabled'].lower() == 'true' %}
        {% if g.team.can_challenge() %}
          {% if challengeable_teams|length > 0 %}
            <form class="form-inline" action="{{ url_for('challenge') }}" method="POST">
              <label for="team_select">Challenge:</label>
              <select name="team_id">
                {% for team in challengeable_teams|sort(attribute='name') %}
                  <option value='{{ team.id }}'>
                    {{ team.name }}
                  </option>
                {% endfor %}
              </select>
              <input type="submit" class="btn btn-default" value="Challenge!">
            </form>
            <p>
              Challenges for people of higher ELO will automatically be accepted.
            </p>
          {% else %}
            <p>
              You're the only team who is ready to play! Please wait a bit for teams to upload their bots.
            </p>
          {% endif %}
        {% else %}
          <p>
            Your team has not uploaded and selected a bot! You must go to the team management page before you can challenge people.
          </p>
        {% endif %}
      {% else %}
        <p>
          Challenges are currently disabled. Upload a bot so you can play immediately when they are enabled.
        </p>
      {% endif %}
    </div>
    <div class="span6">
      <h2>Your Team: {{ g.team.name }}</h2>
      <div>
        <h3>Game Requests</h3>
        <table class="table table-hover table-condensed table-bordered">
          <thead>
            <tr>
              <th>Team</th>
              <th>Time</th>
              <th>Accept</th>
              <th>Reject</th>
            </tr>
          </thead>
          <tbody>
            {% for request in pending_requests %}
              <tr>
                <td>{{ request.challenger.name }}</td>
                <td>{{ request.create_time }}</td>
                <td>
                  <form style="margin: 0;" class="form-inline" action="{{ url_for('answer_request', request_id=request.id) }}", method="POST">
                    <input type="hidden" name="action" value="accept" />
                    <input type="submit" class="btn btn-mini btn-success" value="Accept">
                  </form>
                </td>
                <td>
                  <form style="margin: 0;" class="form-inline" action="{{ url_for('answer_request', request_id=request.id) }}", method="POST">
                    <input type="hidden" name="action" value="reject" />
                    <input type="submit" class="btn btn-mini btn-danger" value="Reject">
                  </form>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan=4>
                  When people of higher ELO challenge you, their requests will appear here.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% include '_recent_games.html' %}
{% endblock %}
